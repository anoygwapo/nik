<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Home | Echoes of Hope</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #7AC7E3;
      --accent: #FFD96A;
      --accent-dark: #E0B14A;
      --bg: #F6FAFB;
      --card: #FFFDF6;
      --gray: #A6BFD8;
      --text-main: #1B2536;
      --text-muted: #6D8BA8;
      --radius: 13px;
    }
    body {
      background: var(--bg);
      font-family: 'Quicksand', 'Inter', sans-serif;
      margin: 0;
      color: var(--text-main);
    }
    .navbar {
      display: flex; justify-content: space-between; align-items: center;
      background: linear-gradient(90deg, var(--primary) 70%, var(--accent) 100%);
      color: #fff;
      padding: 23px 50px;
      font-family: 'Quicksand', sans-serif;
      border-bottom: 2px solid var(--gray);
      box-shadow: 0 4px 18px #7ac7e319;
      position: sticky; top: 0; z-index:1001;
    }
    .navbar .logo {
      font-weight: 700; font-size: 1.85rem; color: #fff;
      letter-spacing: 1.2px; text-shadow: 0 2px 8px #7ac7e3b0;
    }
    .navbar ul {
      display: flex; gap: 30px; list-style: none; margin: 0; padding: 0; align-items: center;
    }
    .navbar a, .navbar span {
      text-decoration: none;
      color: #fff;
      font-weight: 600;
      font-size: 1.12rem;
      padding: 7px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background .18s, color .14s;
    }
    .navbar a:hover, .navbar .active {
      background: rgba(255,217,106,.18);
      color: var(--accent);
    }
    .btn {
      background: var(--accent);
      color: #1B2536;
      padding: 8px 21px;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 2px 8px #ffd96a29;
      margin-left: 8px;
      transition: background .17s;
    }
    .btn:hover { background: var(--accent-dark); color: #fff;}
    .container {
      display: grid;
      grid-template-columns: 330px 1fr 320px;
      gap: 32px;
      max-width: 1340px;
      margin: 45px auto;
      padding: 0 25px;
    }
    @media (max-width: 980px) {
      .container { grid-template-columns: 1fr; }
      .sidebar, .rightbar { margin: 0 0 20px;}
    }
    .sidebar, .rightbar, .create-post, .post {
      background: var(--card);
      border-radius: var(--radius);
      padding: 22px 25px;
      box-shadow: 0 6px 40px #ffd96a1a;
      margin-bottom: 10px;
    }
    .sidebar h3 { color: var(--primary); font-size:1.19rem; margin-bottom:14px; border-bottom:1px solid #eee; padding-bottom:9px;}
    .user-card { display: flex; justify-content: space-between; align-items: center; padding: 8px 0;}
    .user-info { display: flex;align-items:center;gap:9px;}
    .user-info img { width:42px;height:42px;border-radius:50%;object-fit:cover;border:2px solid var(--primary);}
    .follow-btn {
      background: var(--accent); border: none; color: #1B2536; font-weight:700; padding:6px 18px; border-radius:8px; cursor:pointer;
      transition: background .19s;
    }
    .follow-btn.following {background:var(--gray);color:#3b526e;}
    .feed {display: flex;flex-direction:column;gap:24px;}
    .create-post textarea {
      width: 100%; border-radius:10px; border:1px solid #eedc72;
      padding:13px; resize:none; font-family:inherit; font-size:1.10rem;
      margin-bottom:10px; background: #fff;
    }
    .create-post select {
      padding:7px; border-radius:7px; border:1px solid var(--gray);margin-right:13px;
      font-size:16px; background: #fcf8e3;
    }
    .post-header { display: flex; align-items: center; gap: 10px; margin-bottom:13px;}
    .post-header img { width:48px; height:48px; border-radius:50%; border: 2px solid #7AC7E3;}
    .post-user { font-weight: 700; color: var(--primary);}
    .post-type { background: #E3F5FA; color: #7AC7E3; padding: 5px 13px; border-radius:8px; font-size: 0.98rem; margin-left:auto;}
    .post-body { font-size:1.11rem; color:var(--text-main); line-height:1.6; margin-bottom:10px;}
    .post-actions {
      display: flex; justify-content: flex-start; gap:18px;
      padding-top:9px; border-top: 1px solid #f5e8bf; color:var(--text-muted); font-weight:700;
    }
    .post-actions span, .post-actions form button {
      cursor:pointer; display: flex; align-items: center; gap:7px;
      background: none; border:none; font-size:1.1rem;
      transition: color .15s, background .19s;
    }
    .post-actions span:hover, .post-actions form button:hover { color: var(--accent-dark);}
    .comment-section { border-top: 1px solid #ffd96a34; margin-top: 9px; padding-top: 10px;}
    .comment-list p { margin-bottom: 6px; font-size:1.08rem;}
    .comment-box {
      margin-top:6px; display:flex; gap:8px; align-items:center;
    }
    .comment-box input {
      width:80%; padding:9px; border-radius:7px; border: 1px solid #a6bfd8; background:#fff;
    }
    .comment-box button {
      padding:9px 15px; background: var(--primary); color: #fff; font-weight:700;
      border-radius:8px; border:none; cursor:pointer; transition:background .18s;
    }
    .comment-box button:hover { background: #3b90b2;}
    .rightbar h3 { color: var(--accent-dark);}
    .rightbar p { color: var(--text-muted);}
    footer {
      text-align:center; color:var(--text-muted); padding:22px; font-size:1.04rem; margin-top:16px;
    }
    @media(max-width:700px){
      .navbar, .container { padding: 16px;}
      .sidebar, .rightbar, .create-post, .post { padding: 13px 7px;}
      .navbar .logo { font-size: 1rem;}
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo">Echoes of Hope</div>
    <ul>
      <li><a href="{{ url_for('home') }}">Home</a></li>
      <li><a href="{{ url_for('quotes') }}">Quotes</a></li>
      <li><a href="{{ url_for('stories') }}">Stories</a></li>
    </ul>
    <ul>
      {% if session.username %}
        <li><a href="{{ url_for('profile', username=session.username) }}">{{ session.username }}</a></li>
        <li><a class="btn" href="{{ url_for('logout') }}">Log Out</a></li>
      {% else %}
        <li><a class="btn" href="{{ url_for('login') }}">Log In</a></li>
      {% endif %}
    </ul>
  </nav>
  <div class="container">
    <div class="sidebar">
      <h3>People You May Know</h3>
      {% for u in users %}
        {% if u['username'] != session.username %}
          <div class="user-card">
            <div class="user-info">
              <img src="{{ url_for('static', filename=u['avatar'] or 'user2.jpg') }}" alt="avatar">
              <span>{{ u['username'] }}</span>
            </div>
            <form action="{{ url_for('follow', username=u['username']) }}" method="POST">
              {% if u['username'] in following %}
                <button class="follow-btn following" type="submit">Following</button>
              {% else %}
                <button class="follow-btn" type="submit">Follow</button>
              {% endif %}
            </form>
          </div>
        {% endif %}
      {% endfor %}
    </div>
    <div class="feed">
      <div class="create-post">
        <form action="{{ url_for('create_post') }}" method="POST">
          <textarea name="text" placeholder="What's on your mind, {{ session.username }}?" required></textarea>
          <select name="type">
            <option value="quote">Quote</option>
            <option value="story">Story</option>
          </select>
          <button class="btn" type="submit">Post</button>
        </form>
      </div>
      {% for post in posts %}
      <div class="post" data-post-id="{{ post.id }}">
        <div class="post-header">
          <img src="{{ url_for('static', filename='user2.jpg') }}" alt="avatar">
          <a href="{{ url_for('profile', username=post.username) }}" class="post-user">{{ post.username }}</a>
          <span class="post-type">{{ post.type }}</span>
        </div>
        {% if post.original_author %}
          <p style="font-size: 0.97rem; color:var(--accent-dark);">üîÅ Shared from <strong>@{{ post.original_author }}</strong></p>
        {% endif %}
        <div class="post-body">{{ post.text }}</div>
        <div class="post-actions">
          <span class="like-btn">‚ù§Ô∏è <span class="like-count">{{ post.likes }}</span></span>
          <span class="comment-toggle">üí¨ {{ post.comments|length }}</span>
          <form action="{{ url_for('share_post', post_id=post.id) }}" method="POST" style="display:inline;">
            <button type="submit">üîó Share</button>
          </form>
        </div>
        <div class="comment-section" style="display:none;">
          <div class="comment-list">
            {% for c in post.comments %}
              <p><strong>{{ c.user if c.user else c.username }}:</strong> {{ c.text }}</p>
            {% endfor %}
          </div>
          <div class="comment-box">
            <input type="text" class="comment-input" placeholder="Write a comment..." />
            <button class="comment-btn">Post</button>
          </div>
        </div>
      </div>
      {% else %}
        <p>No posts yet. Be the first to share hope!</p>
      {% endfor %}
    </div>
    <div class="rightbar">
      <h3>Trending Topics</h3>
      <p>‚ú® ‚ÄúHope is the thing with feathers...‚Äù</p>
      <p>üí¨ #Motivation #Kindness #SelfGrowth</p>
    </div>
  </div>
  <footer>¬© 2025 Echoes of Hope ‚Äî Keep inspiring üåª</footer>
  <script>
    document.querySelectorAll('.comment-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const post = btn.closest('.post');
        const section = post.querySelector('.comment-section');
        section.style.display = section.style.display === 'none' ? 'block' : 'none';
      });
    });
    document.querySelectorAll('.like-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const postId = btn.closest('.post').dataset.postId;
        const res = await fetch(`/like/${postId}`, { method: 'POST' });
        const data = await res.json();
        if (data.likes !== undefined) {
          btn.querySelector('.like-count').textContent = data.likes;
        }
      });
    });
    document.querySelectorAll('.comment-btn').forEach(btn => {
      btn.addEventListener('click', async () => {
        const post = btn.closest('.post');
        const postId = post.dataset.postId;
        const input = post.querySelector('.comment-input');
        const text = input.value.trim();
        if (!text) return;
        const res = await fetch(`/comment/${postId}`, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ text })
        });
        const data = await res.json();
        if (data.user) {
          const list = post.querySelector('.comment-list');
          list.innerHTML += `<p><strong>${data.user}:</strong> ${data.text}</p>`;
          input.value = '';
        }
      });
    });
  </script>
</body>
</html>